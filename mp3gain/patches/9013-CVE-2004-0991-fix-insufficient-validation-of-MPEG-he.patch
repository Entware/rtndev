From: Simon McVittie <smcv@debian.org>
Date: Sun, 16 Mar 2014 21:10:15 +0000
Subject: CVE-2004-0991: fix insufficient validation of MPEG header values

Taken from mpg123/0.59r-19 by a process of elimination (all the diff
from upstream in layer2.c, except the bits that are CVE-2004-0805)
since I can't find the original patch anywhere. This includes both the
original patch in -18, and the follow-up patch in -19 fixing an
off-by-one error in this boundary check.

Author: Daniel Kobras
Origin: vendor, Debian (mpg123/0.59r-18, mpg123/0.59r-19)
---
 mpglibDBL/layer2.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/mpglibDBL/layer2.c b/mpglibDBL/layer2.c
index 027cced..ca3315d 100644
--- a/mpglibDBL/layer2.c
+++ b/mpglibDBL/layer2.c
@@ -253,7 +253,7 @@ static void II_select_table(struct frame *fr)
        { alloc_0, alloc_1, alloc_2, alloc_3 , alloc_4 };
   static const int sblims[5] = { 27 , 30 , 8, 12 , 30 };
 
-  if(fr->lsf)
+  if(fr->sampling_frequency >= 3)      /* Or equivalent: (fr->lsf == 1) */
     table = 4;
   else
     table = translate[fr->sampling_frequency][2-fr->stereo][fr->bitrate_index];
