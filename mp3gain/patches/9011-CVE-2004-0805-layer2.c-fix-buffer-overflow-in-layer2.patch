From: Simon McVittie <smcv@debian.org>
Date: Sun, 16 Mar 2014 20:52:15 +0000
Subject: CVE-2004-0805: layer2.c: fix buffer overflow in layer2 decoder

Origin: vendor, Debian (mpg123/0.59r-18)
Author: Daniel Kobras <kobras@debian.org>
See-also: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=270542
See-also: http://article.gmane.org/gmane.comp.security.full-disclosure/25471
---
 mpglibDBL/layer2.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/mpglibDBL/layer2.c b/mpglibDBL/layer2.c
index 8f4e9e3..027cced 100644
--- a/mpglibDBL/layer2.c
+++ b/mpglibDBL/layer2.c
@@ -280,6 +280,11 @@ int do_layer2( PMPSTR mp,unsigned char *pcm_sample,int *pcm_point)
   fr->jsbound = (fr->mode == MPG_MD_JOINT_STEREO) ?
      (fr->mode_ext<<2)+4 : fr->II_sblimit;
 
+  if (fr->jsbound > fr->II_sblimit) {
+    fprintf(stderr, "Truncating stereo boundary to sideband limit.\n");
+    fr->jsbound=fr->II_sblimit;
+  }
+
   if(stereo == 1 || single == 3)
     single = 0;
 
